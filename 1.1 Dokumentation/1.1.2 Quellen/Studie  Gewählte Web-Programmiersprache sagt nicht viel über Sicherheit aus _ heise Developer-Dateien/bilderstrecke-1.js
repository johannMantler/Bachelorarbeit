/*
 * bilderstrecke.js, bilderstrecke-1.1.js 
 * 17.03.2014
 * Copyright (c) 2014 Heise Zeitschriften Verlag 
 */

!function(a){"use strict";function b(b,c){return"ir"==c?"hmg-vorschau.heise-cms.de"==document.domain||"www.heise-medien.de"==document.domain?"//www.heise-medien.de/bilderstrecke/bilderstrecke_"+b+".html?callback=?&view=json":"//www.heise.de/bilderstrecke/bilderstrecke_"+b+".html?callback=?&view=json":"autos"==c?a("#bilderstrecke-static-"+b).attr("data-autos-json-url")+"?callback=?&view=json&type=bilderstrecke":"swvz"==c?a("#bilderstrecke-"+b).attr("data-json-url")+"?callback=?":"techstage"==c||"techstage-final"==c?a("#bilderstrecke-"+b).attr("data-json-url"):"inhalt"==c?a("#bilderstrecke-"+b).attr("data-json-url"):void 0}var c={de:{prev:"voriges",next:"nächstes",close:"schließen",source:"Quelle"},en:{prev:"previous",next:"next",close:"close",source:"Source"}};a.fn.bilderstrecke=function(d){function e(b){if(i.zaehlpixel_reload_url){var c=function(){Heise.TrackingReload().reloadAll(function(){return{reloadWebtrekk:{contentId:this.wt.contentId+".bilderstrecke-"+b.cid,contentGroup:this.wt.contentGroup},reloadIntern:{num:b.num}}})};"undefined"==typeof Heise||"undefined"==typeof Heise.TrackingReload?a.getScript(i.zaehlpixel_reload_url,c):c()}}function f(b){var c={ho:"520",ct:"526",ix:"496",tr:"503",apple:"506",mobil:"496",security:"540",netze:"496",open:"530",developer:"558",resale:"516",foto:"530",jobs:"531",hardware_hacks:"369",techstage:"584","techstage-final":"928"},d=a(b).data("channel");void 0!==c[d]&&(i.width=c[d])}function g(b,d,f){var g=!1;1==a(b._bilder).length&&(g=!0);var h=function(f,h){h=h||!1;var j=function(b){var c=0,b=parseInt(a('figure ul li[data-item-no="'+b+'"]',d).index());return a("figure ul li",d).each(function(d){b>d&&(c-=parseInt(a(this).css("width")))}),c+="px"},k=function(b,c,f){a("figure ul",d).css("left",j(f)),a("figure ul li",d).removeClass("pic_shown"),a("figure ul li[data-item-no="+f+"]",d).addClass("pic_shown").attr("data-status","loaded"),a(".pic",d).html(f);var c=parseInt(a("figure ul li[data-item-no="+f+"] img",d).height());a("figure ul li[data-item-no="+f+"] span.creator",d).length>0&&(c+=parseInt(a("figure ul li[data-item-no="+f+"] span.creator",d).outerHeight())),a("figure ul li[data-item-no="+f+"] div.bild_titel",d).length>0&&(c+=parseInt(a("figure ul li[data-item-no="+f+"] div.bild_titel",d).outerHeight())),a("figure ul li[data-item-no="+f+"] div.bu",d).length>0&&(c+=parseInt(a("figure ul li[data-item-no="+f+"] div.bu",d).outerHeight())),c+=5,a("figure, figure ul li[data-item-no="+f+"]",d).css("height",c+"px"),a("figure ul li[data-item-no="+f+'] a[rel="external"]',d).attr("target","_blank"),h||e({num:f,cid:a(d).data("cid")})},l=function(e){var f,g,h=parseInt(a("figure nav .pic_count",d).html());switch(e){case 1:f=h-1,g=e;break;case h:f=e-2,g=0;break;default:f=e-2,g=e}var j="",k="";(""!=b._bilder[f].text_html||""!=b._bilder[f].bildquelle_html||""!=b._bilder[f].titel)&&(""!=b._bilder[f].bildquelle_html&&(j+='<span class="creator" style="max-width: '+b._bilder[f].previewbild_width+'px">'+c[i.language].source+": "+b._bilder[f].bildquelle_html+"</span>"),""!=b._bilder[f].titel&&(j+='<div class="bild_titel" style="max-width: '+b._bilder[f].previewbild_width+'px">'+b._bilder[f].titel+"</div>"),""!=b._bilder[f].text_html&&null!=b._bilder[f].text_html&&(j+='<div class="bu" style="max-width: '+b._bilder[f].previewbild_width+'px">'+b._bilder[f].text_html+"</div>")),(""!=b._bilder[g].text_html||""!=b._bilder[g].bildquelle_html||""!=b._bilder[g].titel)&&(""!=b._bilder[g].bildquelle_html&&(k+='<span class="creator" style="max-width: '+b._bilder[g].previewbild_width+'px">'+c[i.language].source+": "+b._bilder[g].bildquelle_html+"</span>"),""!=b._bilder[g].titel&&(k+='<div class="bild_titel" style="max-width: '+b._bilder[g].previewbild_width+'px">'+b._bilder[g].titel+"</div>"),""!=b._bilder[g].text_html&&null!=b._bilder[g].text_html&&(k+='<div class="bu" style="max-width: '+b._bilder[g].previewbild_width+'px">'+b._bilder[g].text_html+"</div>")),"unloaded"==a("li:eq("+f+")",d).attr("data-status")&&a("<img />").attr("src",b._bilder[f].previewbild_url).load(function(){a("figure ul li:eq("+f+")",d).append(a(this)).attr("data-status","loaded").append(j)}),f!=g&&"unloaded"==a("li:eq("+g+")",d).attr("data-status")&&a("<img />").attr("src",b._bilder[g].previewbild_url).load(function(){a("figure ul li:eq("+g+")",d).append(a(this)).attr("data-status","loaded").append(k)})};if(1==a("figure ul li[data-item-no="+f+"][data-status=loaded]",d).length)k(parseInt(a('figure ul li[data-item-no="'+f+'"]',d).css("width")),parseInt(a('figure ul li[data-item-no="'+f+'"]',d).css("height")),f),g||l(f);else{var m=f-1;a("<img />").attr({src:b._bilder[m].previewbild_url,alt:b._bilder[m].titel}).load(function(){var e="";(""!=b._bilder[m].text_html||""!=b._bilder[m].bildquelle_html||""!=b._bilder[0].titel)&&(""!=b._bilder[m].bildquelle_html&&(e+='<span class="creator" style="max-width: '+b._bilder[m].previewbild_width+'px">'+c[i.language].source+": "+b._bilder[m].bildquelle_html+"</span>"),""!=b._bilder[m].titel&&(e+='<div class="bild_titel" style="max-width: '+b._bilder[m].previewbild_width+'px">'+b._bilder[m].titel+"</div>"),""!=b._bilder[m].text_html&&null!=b._bilder[m].text_html&&(e+='<div class="bu" style="max-width: '+b._bilder[m].previewbild_width+'px">'+b._bilder[m].text_html+"</div>")),a('figure ul li[data-item-no="'+f+'"]',d).append(a(this)).append(e),k(parseInt(a('li[data-item-no="'+f+'"]',d).css("width")),parseInt(a('li[data-item-no="'+f+'"]',d).css("height")),f),g||l(f)})}},j=function(){a(d).empty(),a(d).prepend("<h4>"+b.titel+"</h4>"),a(d).append('<figure style="width: '+i.width+'px;" />');var e="";(""!=b._bilder[0].text_html||""!=b._bilder[0].bildquelle_html||""!=b._bilder[0].titel)&&(""!=b._bilder[0].bildquelle_html&&(e+='<span class="creator" style="max-width: '+b._bilder[0].previewbild_width+'px">'+c[i.language].source+": "+b._bilder[0].bildquelle_html+"</span>"),""!=b._bilder[0].titel&&(e+='<div class="bild_titel" style="max-width: '+b._bilder[0].previewbild_width+'px">'+b._bilder[0].titel+"</div>"),""!=b._bilder[0].text_html&&null!=b._bilder[0].text_html&&(e+='<div class="bu" style="max-width: '+b._bilder[0].previewbild_width+'px">'+b._bilder[0].text_html+"</div>")),a("figure",d).append('<nav></nav><ul><li class="pic_shown" data-item-no="1" data-status="loaded" style="width: '+i.width+"px; height: "+b._bilder[0].previewbild_height+'px;"></li></ul>'),a("figure nav",d).append('<span class="pic_prev">&lt;</span> <span class="pic">1</span>/<span class="pic_count">'+a(b._bilder).length+'</span> <span class="pic_next">&gt;</span>');var f,j=parseInt(i.width);for(f=1;f<a(b._bilder).length;f++){var k=f+1;a("figure ul",d).append('<li data-item-no="'+k+'" data-status="unloaded" style="width: '+i.width+"px; height: "+b._bilder[f].previewbild_height+'px;"></li>'),j+=parseInt(i.width)}a("figure ul",d).css("width",j+"px"),g&&a(d).addClass("single_image"),a("<img />").attr({src:b._bilder[0].previewbild_url,alt:b._bilder[0].titel}).load(function(){a('figure ul li[data-item-no="1"]',d).append(a(this)).append(e),h(i.start,!0),("ho"==a(d).data("channel")||"ix"==a(d).data("channel")||"security"==a(d).data("channel")||"open"==a(d).data("channel"))&&a("#mitte_links").trigger("HeiseContentChanged","#mitte_links, #mitte_rechts")})},k=function(f,h,j){var k=a(d).data("full_loaded")||{};if(a(j).addClass("loading"),g&&a(j).addClass("single_image"),!k.hasOwnProperty(f)){a("figure",j).prepend('<span class="loader">Bild wird geladen...</span>');var l=parseInt(a("figure",j).css("height"))/2-parseInt(a("figure .loader",j).height())/2+"px",m=parseInt(a("figure",j).css("width"))/2-parseInt(a("figure .loader",j).width())/2+"px";a("figure .loader",j).css({top:l,left:m})}a("<img />").attr({src:b._bilder[h].bild_url,alt:b._bilder[h].bild_alttext_html,title:c[i.language].next}).load(function(){a("figcaption",j).remove(),a("figure .loader",j).remove(),parseInt(a("body").width())>parseInt(b._bilder[h].bild_width)?a("figure",j).css("width",b._bilder[h].bild_width+"px"):a("figure",j).css("width",parseInt(a("body").width())-50+"px"),a("figure img",j).replaceWith(a(this));var c=parseInt(a("nav",j).outerHeight()),e=0;(""!=b._bilder[h].text_html||""!=b._bilder[h].bildquelle_html)&&(a("figure",j).append("<figcaption />"),""!=b._bilder[h].text_html&&null!=b._bilder[h].text_html&&(a("figure figcaption",j).append(""!=a(d).data("channel")?"<div><p>"+b._bilder[h].text_html+"</p></div>":"<div>"+b._bilder[h].text_html+"</div>"),a("figure figcaption div > p",j).each(function(){e+=parseInt(a(this).outerHeight())})),""!=b._bilder[h].bildquelle_html&&(a("figure figcaption",j).prepend('<span class="source">'+b._bilder[h].bildquelle_html+"</span>"),e+=parseInt(a("figure figcaption span",j).height())),a("figure figcaption",j).css("height",e+"px"),e=parseInt(a("figure figcaption",j).outerHeight())),c+=e,c+=parseInt(parseInt(a("body").width())<parseInt(b._bilder[h].bild_width)?Math.round(parseInt(b._bilder[h].bild_height)*parseFloat((parseInt(a("body").width())-50)/parseInt(b._bilder[h].bild_width))):b._bilder[h].bild_height),a("figure",j).css("height",c+"px"),a("figure nav .pic",j).html(f),a(j).removeClass("loading"),a(j).css(parseInt(a("body").width())>parseInt(b._bilder[h].bild_width)?{width:parseInt(b._bilder[h].bild_width)+"px",left:parseInt(a("body").width())/2-parseInt(b._bilder[h].bild_width)/2+"px"}:{width:parseInt(a("body").width())-50+"px",left:parseInt(a("body").width())/2-(parseInt(a("body").width())-50)/2+"px"}),a('figure figcaption a[rel="external"]').attr("target","_blank"),k.hasOwnProperty(f)||(k[f]=!0,a(d).data("full_loaded",k))}),e({num:f,cid:a(d).data("cid")})},l=function(d,e){var f=d-1,g=Math.round(1e4*Math.random());a("body").prepend('<div id="white_canvas">&nbsp;</div> <div class="bilderstrecke_full" id="full-'+g+'" />'),a("#white_canvas").animate({opacity:"1.0"},300,function(){var j="";j=a.browser.mozilla||a.browser.msie||a.browser.opera?a("html").scrollTop():a("body").scrollTop();var l=a("body div#full-"+g).css("top",j+"px");a(l).prepend('<span class="close_x">'+c[i.language].close+' <em>X</em></span><figure style="width: '+b._bilder[f].bild_width+'px;"><nav /></figure>'),a("figure nav",l).prepend('<span class="pic_prev">'+c[i.language].prev+'</span><span class="orientation"><span class="pic">'+d+'</span>/<span class="pic_count">'+e+'</span></span><span class="pic_next">'+c[i.language].next+"</span>");var m=parseInt(a("figure nav",l).outerHeight())+parseInt(b._bilder[f].bild_height);a("figure",l).append('<img src="'+b._bilder[f].previewbild_url+'" />').css("height",m+"px"),k(d,f,l),a(".pic_prev",l).live("click",function(){if(1==parseInt(a(".pic",l).html()))var b=parseInt(a(".pic_count",l).html()),c=b-1;else var b=parseInt(a(".pic",l).html())-1,c=b-1;k(b,c,l)}),a(".pic_next",l).live("click",function(){if(parseInt(a(".pic",l).html())==parseInt(a(".pic_count",l).html()))var b=1,c=0;else var b=parseInt(a(".pic",l).html())+1,c=b-1;k(b,c,l)}),a("figure > img",l).live("click",function(){a(".pic_next",l).click()}),a(".close_x",l).add("#white_canvas").bind("click",function(){if("inline"!=i.mode){var b=parseInt(a("figure nav .pic",l).html());h(b)}a(l).remove(),a("#white_canvas").remove()}),a(document.documentElement).keyup(function(b){if(0==a("input:focus").length&&0==a("textarea:focus").length&&1==a("body .bilderstrecke_full").length)switch(b.which){case 37:a(".pic_prev",l).click();break;case 39:a(".pic_next",l).click();break;case 27:a("body .bilderstrecke_full .close_x").click()}})})};("inline-full"==i.mode||"inline"==i.mode)&&j(),"full"!=i.mode&&(a(".pic_prev",d).live("click",function(){if(1==parseInt(a(".pic",d).html()))var b=parseInt(a(".pic_count",d).html());else var b=parseInt(a(".pic",d).html())-1;h(b)}),a(".pic_next",d).live("click",function(){if(parseInt(a(".pic",d).html())==parseInt(a(".pic_count",d).html()))var b=1;else var b=parseInt(a(".pic",d).html())+1;h(b)}),a(document.documentElement).keyup(function(b){if(0==a("input:focus").length&&0==a("textarea:focus").length&&1==a(".bilderstrecke_vorschau.js").length&&0==a("body .bilderstrecke_full").length)switch(b.which){case 37:a(".pic_prev",d).click();break;case 39:a(".pic_next",d).click()}})),"inline-full"==i.mode&&a("figure ul li img",d).live("click",function(){l(parseInt(a(".pic",d).html()),parseInt(a(".pic_count",d).html()))}),"full"==i.mode&&a("autos"==f?"a":"a:has(img)",d).live("click",function(c){c.preventDefault(),l(parseInt(i.start),parseInt(a(b._bilder).length))})}var h={url:b,type:"",start:1,mode:"inline-full",width:"520",zaehlpixel_reload_url:"/js/ho/tracking-reload.min.js",css_url:"/stil/bilderstrecke.css",language:"de"},i=a.extend(!0,h,d);return document.createStyleSheet?document.createStyleSheet(i.css_url):a("head").append('<link rel="stylesheet" type="text/css" href="'+i.css_url+'" />'),this.each(function(){var c,e;if(a(this).attr("data-autos-json-url")?(c=Math.round(1e4*Math.random()),"full"!=i.mode?a(this).attr("id","bilderstrecke-"+c).addClass("js"):a(this).attr("id","bilderstrecke-static-"+c),e=b(c,"autos")):a(this).attr("data-cid")&&!a(this).attr("data-json-url")?(c=a(this).attr("data-cid"),"full"!=i.mode?a(this).attr("id","bilderstrecke-"+c).addClass("js"):a(this).attr("id","bilderstrecke-static-"+c),e=b(c,"ir")):a(this).attr("data-json-url")&&(c=Math.round(1e4*Math.random()),"full"!=i.mode?a(this).attr("id","bilderstrecke-"+c).addClass("js"):a(this).attr("id","bilderstrecke-static-"+c),e="techstage"==a(this).data("channel")||"techstage-final"==a(this).data("channel")?b(c,"techstage"):"inhalt"==a(this).data("channel")?b(c,"inhalt"):b(c,"swvz")),"inline-full"==i.mode&&a(this).addClass("inline-full"),a("#bilderstrecke-"+c+" + .bilderstrecke_unterschrift").remove(),"full"!=i.mode)var h=a("#bilderstrecke-"+c);else var h=a("#bilderstrecke-static-"+c);(void 0===d||void 0===d.width)&&f(h),a(this).css("width",i.width+"px"),""!=a(h).data("channel")&&void 0!=a(h).data("channel")?a.getJSON(e,{channel:a(h).data("channel")},function(a){g(a,h,i.type)}):a.getJSON(e,function(a){g(a,h,i.type)})})}}(jQuery);
//# sourceMappingURL=bilderstrecke-1.1.min.map